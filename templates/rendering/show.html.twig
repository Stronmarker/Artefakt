{% extends 'base.logged.html.twig' %}

{% block title %}Rendering Details{% endblock %}

{% block body %}

<div class="container mt-4 card-shadow bg-white p-3 box-shadow" data-controller="sweetalert">
    <a href="{{ path('project_show', {id: project.id}) }}" class="btn btn-secondary btn-sm">Retour au projet</a>
    <a href="{{ path('rendering_feedbacks', {'rendering_id': rendering.id}) }}" class="btn btn-dark btn-sm">Voir les Feedbacks</a>

    <h1 class="text-success text-center h2">Nom du Rendu : {{ rendering.renderingName }}</h1>
    
    <section class="d-flex align-items-center justify-content-between">
        <div>
            <h2 class="h6 p-1">Date de création : {{ rendering.createdAt|date('d/m/Y') }}</h2>
        </div>

        {% if lastFeedback %}
            <div>
                <h2 class="h6 p-1">Dernier feedback : {{ lastFeedback.createdAt|date('d/m/Y') }}</h2>
            </div>
            <div>
                <h2 class="h6 p-1">
                    Statut :
                    {% if lastFeedback.isAccepted %}
                        <span class="badge bg-success">Accepté</span>
                    {% else %}
                        <span class="badge bg-danger">Rejeté</span>
                    {% endif %}
                </h2>
            </div>
        {% else %}
            <div>
                <h2 class="h6 p-1 text-muted">Aucun feedback disponible</h2>
            </div>
        {% endif %}
    </section>

    <p class="p-1"><strong>Lien client :</strong>
        <a class="text-success" href="{{ url('rendering_client_show', {'token': rendering.token}) }}" target="_blank">{{ url('rendering_client_show', {'token': rendering.token}) }}</a>
    </p>

    <div data-controller="image" data-image-front-png="{{ vich_uploader_asset(rendering, 'frontPngFile') }}"
        data-image-toward-png="{{ vich_uploader_asset(rendering, 'towardPngFile') }}">

        <div data-image-target="canvasContainer"
            style="width: 100%; height: 380px; border: 1px solid #ccc; margin-bottom: 10px;"></div>

        <div class="button-container d-flex justify-content-between p-3">
            <button class="btn btn-secondary flex-grow-1 me-2 btn-sm" data-action="click->image#toggleRotation"
                data-image-target="resetButton">
                <i class="fas fa-sync-alt"></i> Rotation
            </button>
            <button class="btn btn-secondary flex-grow-1 me-2 btn-sm" data-action="click->image#resetCamera"
                data-image-target="resetButton">
                <i class="fas fa-camera"></i> Caméra
            </button>
            <a href="{{ path('rendering_edit', {'project_id': project.id, 'rendering_id': rendering.id}) }}" class="btn btn-dark flex-grow-1 me-2 btn-sm">
                <i class="fas fa-edit"></i> Modifier
            </a>
            <form method="post" action="{{ path('rendering_delete', {'project_id': project.id, 'rendering_id': rendering.id}) }}" class="flex-grow-1 delete-form">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ rendering.id) }}">
                <button type="submit" class="btn btn-danger w-100 btn-sm">
                    <i class="fas fa-trash-alt"></i> Supprimer
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
